<!DOCTYPE html>
<html>
<head>
    <title>WebAR App</title>
    <!-- viewport 메타 태그 추가 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <style>
        /* Basic CSS for the camera button */
        #cameraButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 12px; /* Rounded corners */
            cursor: pointer;
        }
          #arCanvas {
            display: none; /* 초기에는 숨김 */
        }
    </style>
     
     <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://ar-js-org.github.io/AR.js/aframe/build/aframe-ar.js"></script>
</head>
    
</head>
<body>
    <!-- Placeholder for AR content -->
    <div id="arContent">
     <!-- A-Frame AR 씬 설정 -->
         <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
            <!-- 마커 기반 앵커 설정 -->
            <a-marker preset="hiro">
                <a-entity gltf-model="https://belivvr.github.io/luke/suncheoneconet/armodel/Cat.glb" scale="1.6 1.6 1.6"></a-entity>
            </a-marker>
            <a-entity camera></a-entity>
        </a-scene>
        
    </div>

    <!-- Camera button -->
    <button id="cameraButton">Take Photo</button>

    <canvas id="arCanvas"></canvas>

    <script>
        // JavaScript to detect if the user is in a webview and prompt to open in a browser
        window.onload = function() {
            var userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/FBAN|FBAV|KAKAOTALK/i.test(userAgent)) {
                alert("Please open this page in a browser such as Chrome for the best experience.");
            }

            // Additional JavaScript for AR functionality and camera button will go here
        }


         // 카메라 버튼 클릭 시 사진 촬영
        document.getElementById('cameraButton').addEventListener('click', function() {
            var scene = document.querySelector('a-scene');
            if (scene && scene.components.screenshot) {
                scene.components.screenshot.capture('perspective');
            }
        });

        // A-Frame 스크린샷 컴포넌트 추가
        AFRAME.registerComponent('screenshot', {
            init: function () {
                var component = this;
                this.el.addEventListener('loaded', function() {
                    component.canvas = document.createElement('canvas');
                    document.body.appendChild(component.canvas);
                    component.canvas.id = 'arCanvas';
                    component.canvas.width = window.innerWidth;
                    component.canvas.height = window.innerHeight;
                    component.context = component.canvas.getContext('2d');
                });
            },
            capture: function (projection) {
                var canvas = this.canvas;
                var context = this.context;
                var renderer = this.el.renderer;
                var camera = this.el.camera.el.getObject3D('camera');
                renderer.render(this.el.object3D, camera, canvas);
                var dataURL = canvas.toDataURL('image/png');
                var link = document.createElement('a');
                link.download = 'ar-photo.png';
                link.href = dataURL;
                link.click();
            }
        });
    </script>
</body>
</html>
